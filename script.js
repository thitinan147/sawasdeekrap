
// Prize data - Valentine's Day Theme
const prizes = [
  {
    icon: 'üåπ',
    title: '‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à',
    description: '‡∏™‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡πà‡∏ô‡πÄ‡∏™‡∏°‡∏≠',
    message: '<p>‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡πÉ‡∏Ñ‡∏£‡∏°‡∏≤‡∏°‡∏≠‡∏ö‡πÉ‡∏´‡πâ</p><p>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ò‡∏≠‡∏™‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏û‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏≠‡∏ö‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞</p>',
    color: ['#F8BBD9', '#F48FB1']
  },
  {
    icon: 'üç´',
    title: '‡∏ä‡πá‡∏≠‡∏Ñ‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏£‡∏™‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô',
    description: '‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏ß‡∏≤‡∏ô‡∏•‡πâ‡∏≥',
    message: '<p>‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ä‡πá‡∏≠‡∏Ñ‡πÇ‡∏Å‡πÅ‡∏•‡∏ï</p><p>‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏™‡∏Ç‡∏°‡πÑ‡∏õ‡∏ö‡πâ‡∏≤‡∏á ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡∏°‡∏≤</p>',
    color: ['#D7CCC8', '#BCAAA4']
  },
  {
    icon: 'üíå',
    title: '‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á',
    description: '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏Ñ‡∏≠‡∏¢',
    message: '<p>‡∏£‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ô‡∏∞</p><p>‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠‡πÑ‡∏õ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</p>',
    color: ['#FFCDD2', '#EF9A9A']
  },
  {
    icon: 'üçï',
    title: '‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å',
    description: '‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°',
    message: '<p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏Å‡πá‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤</p><p>‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÅ‡∏ï‡πà‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡πá‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏´‡∏•‡∏∞</p>',
    color: ['#FFCC80', '#FFB74D']
  },
  {
    icon: 'üß∏',
    title: '‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡∏´‡∏°‡∏µ‡∏õ‡∏•‡∏≠‡∏ö‡πÉ‡∏à',
    description: '‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≠‡∏î',
    message: '<p>‡∏´‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏á‡∏≤</p><p>‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÄ‡∏ò‡∏≠‡πÄ‡∏™‡∏°‡∏≠‡∏ô‡∏∞</p>',
    color: ['#D1C4E9', '#B39DDB']
  },
  {
    icon: '‚òï',
    title: '‡∏Å‡∏≤‡πÅ‡∏ü‡∏≠‡∏∏‡πà‡∏ô‡πÜ',
    description: '‡∏≠‡∏∏‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô',
    message: '<p>‡∏à‡∏¥‡∏ö‡∏ä‡πâ‡∏≤‡πÜ ‡∏™‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢</p><p>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏î‡∏µ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏µ‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</p>',
    color: ['#C8E6C9', '#A5D6A7']
  },
  {
    icon: 'üåü',
    title: '‡∏î‡∏≤‡∏ß‡πÄ‡∏î‡πà‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏µ',
    description: '‡∏™‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á',
    message: '<p>‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≤‡∏ß‡∏î‡∏ß‡∏á‡∏ô‡∏±‡πâ‡∏ô</p><p>‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏Ñ‡∏£ ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>',
    color: ['#FFF59D', '#FFF176']
  },
  {
    icon: 'üßÅ',
    title: '‡∏Ñ‡∏±‡∏û‡πÄ‡∏Ñ‡πâ‡∏Å‡∏´‡∏ß‡∏≤‡∏ô‡∏•‡∏¥‡πâ‡∏ô',
    description: '‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
    message: '<p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÇ‡∏ï</p><p>‡πÅ‡∏Ñ‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏£‡πà‡∏≠‡∏¢‡∏Å‡πá‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡∏°‡∏±‡πâ‡∏¢‡∏•‡∏∞</p>',
    color: ['#F8BBD0', '#F48FB1']
  },
  {
    icon: 'üéà',
    title: '‡∏•‡∏π‡∏Å‡πÇ‡∏õ‡πà‡∏á‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π',
    description: '‡∏•‡∏≠‡∏¢‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ',
    message: '<p>‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡∏≤‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏ô‡∏±‡∏Å‡πÉ‡∏à</p><p>‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ö‡∏ô‡∏ü‡πâ‡∏≤‡∏™‡∏π‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ö‡∏≤‡∏™‡∏ö‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ã‡∏∞‡∏ö‡πâ‡∏≤‡∏á</p>',
    color: ['#E1BEE7', '#CE93D8']
  },
  {
    icon: 'üéÅ',
    title: '‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç',
    description: '‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏à‡∏≤‡∏Å‡πÉ‡∏à',
    message: '<p>‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p><p>‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏ò‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡πâ‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</p>',
    color: ['#B3E5FC', '#81D4FA']
  },
  {
    icon: 'üéÆ',
    title: '‡πÄ‡∏Å‡∏°‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢',
    description: '‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏≠‡∏±‡∏û‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï',
    message: '<p>‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ</p><p>‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏ò‡∏≠‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞</p>',
    color: ['#B2DFDB', '#80CBC4']
  },
  {
    icon: 'üß£',
    title: '‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠‡∏≠‡∏∏‡πà‡∏ô‡πÉ‡∏à',
    description: '‡∏Å‡∏≠‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô',
    message: '<p>‡∏´‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ</p><p>‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏∞‡∏´‡∏ô‡∏≤‡∏ß‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ò‡∏≠‡∏Å‡πá‡∏¢‡∏±‡∏á‡∏≠‡∏∏‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏î‡∏µ</p>',
    color: ['#FFCCBC', '#FFAB91']
  },
  {
    icon: 'üéµ',
    title: '‡πÄ‡∏û‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à',
    description: '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç',
    message: '<p>‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ñ‡∏•‡∏¥‡∏ö‡πÄ‡∏Ñ‡∏•‡∏¥‡πâ‡∏°‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡∏°‡∏±‡∏ô</p><p>‡∏ö‡∏≤‡∏á‡∏ó‡∏µ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡πå‡∏Å‡πá‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ô‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏∞</p>',
    color: ['#D1C4E9', '#B39DDB']
  },
  {
    icon: 'üç©',
    title: '‡πÇ‡∏î‡∏ô‡∏±‡∏ó‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á',
    description: '‡∏´‡∏ß‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏á',
    message: '<p>‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö</p><p>‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πá‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡πÅ‡∏Ñ‡πà‡∏°‡∏µ‡∏£‡∏π‡∏Ç‡∏≤‡∏î‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô ‡∏Å‡πá‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏≤‡∏ô‡∏•‡∏á‡πÑ‡∏õ</p>',
    color: ['#FFE0B2', '#FFCC80']
  },
  {
    icon: 'üåà',
    title: '‡∏™‡∏≤‡∏¢‡∏£‡∏∏‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ù‡∏ô',
    description: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤',
    message: '<p>‡∏´‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏¢‡∏∏‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ</p><p>‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡∏à‡∏∞‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏™‡∏°‡∏≠ ‡∏£‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏ô‡∏∞</p>',
    color: ['#C8E6C9', '#A5D6A7']
  }
];

// State
let hasPlayed = false;
let selectedPrize = null;
let isSpinning = false;

// DOM elements
const capsulesContainer = document.getElementById('capsulesContainer');
const gachaKnob = document.getElementById('gachaKnob');
const prizeCapsule = document.getElementById('prizeCapsule');
const prizeIcon = document.getElementById('prizeIcon');
const tapHint = document.getElementById('tapHint');
const prizeCard = document.getElementById('prizeCard');
const cardEmoji = document.getElementById('cardEmoji');
const cardTitle = document.getElementById('cardTitle');
const cardDescription = document.getElementById('cardDescription');
const cardMessage = document.getElementById('cardMessage');
const btnFinish = document.getElementById('btnFinish');
const finalMessage = document.getElementById('finalMessage');

// Initialize
function init() {
  // Random prize once at start
  selectedPrize = prizes[Math.floor(Math.random() * prizes.length)];
  createMiniCapsules();
}

function createMiniCapsules() {
  const colors = [
    ['#FFCDD2', '#EF9A9A'],
    ['#B3E5FC', '#81D4FA'],
    ['#C8E6C9', '#A5D6A7'],
    ['#FFE0B2', '#FFCC80'],
    ['#E1BEE7', '#CE93D8'],
    ['#F8BBD9', '#F48FB1']
  ];

  for (let i = 0; i < 12; i++) {
    const capsule = document.createElement('div');
    capsule.className = 'capsule-mini';
    capsule.style.background = `linear-gradient(145deg, ${colors[i % colors.length][0]}, ${colors[i % colors.length][1]})`;
    capsule.style.left = `${10 + (i % 4) * 25}%`;
    capsule.style.top = `${10 + Math.floor(i / 4) * 30}%`;
    capsule.style.animationDelay = `${i * 0.2}s`;
    capsulesContainer.appendChild(capsule);
  }
}

// Spin gacha
function spinGacha() {
  if (isSpinning || hasPlayed) return;
  
  isSpinning = true;
  hasPlayed = true;

  gachaKnob.classList.add('spinning');

  setTimeout(() => {
    gachaKnob.classList.remove('spinning');
    gachaKnob.classList.add('disabled');
    showCapsule();
  }, 800);
}

function showCapsule() {
  prizeCapsule.querySelector('.capsule-top').style.background =
    `linear-gradient(145deg, ${selectedPrize.color[0]}, ${selectedPrize.color[1]})`;

  prizeIcon.textContent = selectedPrize.icon;

  prizeCapsule.classList.remove('opened');
  prizeCapsule.classList.add('visible', 'bounce');
  tapHint.classList.add('visible');

  setTimeout(() => {
    prizeCapsule.classList.remove('bounce');
    isSpinning = false;
  }, 600);
}

function openCapsule() {
  if (prizeCapsule.classList.contains('opened')) return;

  prizeCapsule.classList.add('opened');
  tapHint.classList.remove('visible');

  setTimeout(() => {
    showPrizeCard();
  }, 500);
}

function showPrizeCard() {
  cardEmoji.textContent = selectedPrize.icon;
  cardTitle.textContent = selectedPrize.title;
  cardDescription.textContent = selectedPrize.description;
  cardMessage.innerHTML = selectedPrize.message;

  prizeCard.classList.add('visible');
}

function closePrizeCard() {
  prizeCard.classList.remove('visible');

  setTimeout(() => {
    prizeCapsule.classList.remove('visible', 'opened');
    showFinalMessage();
  }, 300);
}

function showFinalMessage() {
  finalMessage.classList.add('visible');
}

// Event listeners
gachaKnob.addEventListener('click', spinGacha);

prizeCapsule.addEventListener('click', () => {
  if (prizeCapsule.classList.contains('visible') && !prizeCapsule.classList.contains('opened')) {
    openCapsule();
  }
});

btnFinish.addEventListener('click', closePrizeCard);

// Keyboard support
gachaKnob.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    spinGacha();
  }
});

prizeCapsule.setAttribute('tabindex', '0');
prizeCapsule.setAttribute('role', 'button');
prizeCapsule.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    openCapsule();
  }
});

// Initialize
init();
